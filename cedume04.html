<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>어휘끝 중학필수 단어 시험 (Unit 31-40)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        .correct-flash { animation: flash-green 0.5s; }
        .incorrect-flash { animation: flash-red 0.5s; }
        @keyframes flash-green { 50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.5); } }
        @keyframes flash-red { 50% { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.5); } }
        #toast { transition: opacity 0.3s, transform 0.3s; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen font-sans">
    <div id="app-container" class="w-full max-w-2xl mx-auto bg-white shadow-xl rounded-lg p-4 sm:p-8">
        <!-- HTML 구조는 1-10 유닛 앱과 동일 -->
        <div id="user-info-screen">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">사용자 정보 입력</h1>
            <p class="text-center text-gray-600 mb-8">결과 저장에 사용될 정보를 입력해주세요.</p>
            <div class="space-y-4">
                <div><label for="school-input" class="block text-sm font-medium text-gray-700">학교</label><input type="text" id="school-input" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm" placeholder="예: 새싹중학교"></div>
                <div><label for="grade-input" class="block text-sm font-medium text-gray-700">학년</label><input type="text" id="grade-input" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm" placeholder="예: 1"></div>
                <div><label for="name-input" class="block text-sm font-medium text-gray-700">이름</label><input type="text" id="name-input" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm" placeholder="예: 홍길동"></div>
            </div>
            <button id="start-app-button" class="w-full mt-8 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700">시험 시작하기</button>
        </div>
        <div id="unit-selection-screen" class="hidden">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">어휘끝 중학필수 단어 시험</h1>
            <p class="text-center text-gray-600 mb-8">시험 볼 유닛을 선택하세요. (Unit 31-40)</p>
            <div id="unit-buttons" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
        </div>
        <div id="test-screen" class="hidden">
            <div class="flex justify-between items-center mb-6"><h2 id="test-title" class="text-xl sm:text-2xl font-bold"></h2><div id="timer" class="text-lg font-semibold text-red-500 bg-red-100 px-4 py-2 rounded-lg">10:00</div></div>
            <div class="mb-6"><div class="w-full bg-gray-200 rounded-full h-2.5"><div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full"></div></div><p id="progress-text" class="text-center text-sm text-gray-600 mt-2"></p></div>
            <div id="question-container" class="text-center p-6 bg-gray-50 rounded-lg"><p id="question-type" class="text-sm font-semibold text-blue-600 mb-2"></p><p id="question" class="text-2xl sm:text-3xl font-medium mb-6 min-h-[72px] flex items-center justify-center"></p><input type="text" id="answer-input" class="w-full p-3 border rounded-lg text-lg text-center" placeholder="정답을 입력하세요"></div>
            <button id="next-button" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700">다음</button>
        </div>
        <div id="results-screen" class="hidden">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">시험 결과</h2>
            <div id="score-container" class="text-5xl font-bold text-center py-8 mb-6 rounded-lg"><span id="final-score"></span><span class="text-3xl text-gray-500"> / 100</span></div>
            <h3 class="text-lg font-semibold mb-4">틀린 문제 목록</h3>
            <div class="overflow-x-auto border rounded-lg max-h-64">
                <table class="min-w-full divide-y"><thead class="bg-gray-50 sticky top-0"><tr><th class="px-4 py-3 text-left text-xs font-medium uppercase">문제</th><th class="px-4 py-3 text-left text-xs font-medium uppercase">제출한 답</th><th class="px-4 py-3 text-left text-xs font-medium uppercase">정답</th><th class="px-4 py-3 text-left text-xs font-medium uppercase">점수</th></tr></thead><tbody id="incorrect-answers-body" class="bg-white divide-y"></tbody></table>
            </div>
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button id="save-results-button" class="w-full bg-green-500 text-white font-bold py-3 rounded-lg">결과 저장</button>
                <button id="retry-button" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg">다시 풀기</button>
                <button id="home-button" class="w-full bg-gray-500 text-white font-bold py-3 rounded-lg">처음으로</button>
            </div>
        </div>
    </div>
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-5 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-5"></div>
    <script>
        const vocabularyData = {
            "Unit 31": [
                { word: "nature", meaning: "자연; 천성, 본성" }, { word: "save", meaning: "(위험에서) 구하다; (돈을) 모으다, 저축하다" }, { word: "cloud", meaning: "구름" }, { word: "drop", meaning: "(액체의) 방울; 떨어뜨리다, 떨어지다" }, { word: "light", meaning: "빛; 전등; 밝은; (색이) 연한; 가벼운" }, { word: "shadow", meaning: "그림자, 그늘" }, { word: "sunlight", meaning: "햇빛, 햇살" }, { word: "heat", meaning: "열기, 열; 더위" }, { word: "smoke", meaning: "연기; (연기, 담배 등을) 피우다" }, { word: "land", meaning: "육지, 땅" }, { word: "ground", meaning: "땅, 토양" }, { word: "island", meaning: "섬" }, { word: "desert", meaning: "사막" }, { word: "field", meaning: "들판, 밭; 분야" }, { word: "mountain", meaning: "산" }, { word: "hill", meaning: "(나지막한) 산, 언덕" }, { word: "valley", meaning: "계곡, 골짜기" }, { word: "cave", meaning: "동굴" }, { word: "hole", meaning: "구덩이; 구멍" }, { word: "ocean", meaning: "대양, 큰 바다" }, { word: "bay", meaning: "만(灣)" }, { word: "river", meaning: "강" }, { word: "lake", meaning: "호수" }, { word: "pond", meaning: "연못" }, { word: "wave", meaning: "파도, 물결; 흔들다" }
            ],
            "Unit 32": [
                { word: "forest", meaning: "숲, 삼림" }, { word: "wood", meaning: "나무, 목재; (-s) 숲" }, { word: "rainforest", meaning: "열대 우림" }, { word: "grass", meaning: "풀, 잔디" }, { word: "grow", meaning: "자라다, 성장하다, 크다" }, { word: "rock", meaning: "암석; 바위, 바윗돌" }, { word: "stone", meaning: "돌, 돌멩이" }, { word: "pebble", meaning: "조약돌, 자갈" }, { word: "sand", meaning: "모래; (-s) 사막" }, { word: "soil", meaning: "토양, 흙" }, { word: "mud", meaning: "진흙" }, { word: "environment", meaning: "환경" }, { word: "pollute", meaning: "오염시키다" }, { word: "flood", meaning: "홍수" }, { word: "damage", meaning: "손상, 피해; 손상을 주다, 피해를 입히다" }, { word: "destroy", meaning: "파괴하다" }, { word: "wild", meaning: "야생의; 자연 그대로의; 사나운, 거친" }, { word: "form", meaning: "형성되다, 형성시키다; 종류, 형태" }, { word: "waste", meaning: "낭비하다; 낭비, 허비; 쓰레기, 폐기물" }, { word: "plastic", meaning: "플라스틱" }, { word: "oil", meaning: "기름, 석유" }, { word: "survive", meaning: "살아남다, 생존하다" }, { word: "protect", meaning: "보호하다" }, { word: "reduce", meaning: "줄이다, 축소하다; (가격을) 낮추다" }, { word: "recycle", meaning: "재활용하다, 재생하다" }
            ],
            "Unit 33": [
                { word: "beast", meaning: "(특히 덩치가 크고 위험한) 짐승, 야수" }, { word: "pet", meaning: "애완동물" }, { word: "feed", meaning: "먹이를 주다; (동물의) 먹이" }, { word: "hunt", meaning: "사냥하다; 찾다, 뒤지다" }, { word: "bark", meaning: "(개가) 짖다" }, { word: "whale", meaning: "고래" }, { word: "dolphin", meaning: "돌고래" }, { word: "elephant", meaning: "코끼리" }, { word: "giraffe", meaning: "기린" }, { word: "bull", meaning: "황소" }, { word: "sheep", meaning: "양" }, { word: "camel", meaning: "낙타" }, { word: "kangaroo", meaning: "캥거루" }, { word: "fur", meaning: "털, 모피" }, { word: "tail", meaning: "꼬리" }, { word: "chicken", meaning: "닭" }, { word: "owl", meaning: "올빼미, 부엉이" }, { word: "parrot", meaning: "앵무새" }, { word: "wing", meaning: "(새·곤충의) 날개; (비행기의) 날개" }, { word: "feather", meaning: "털, 깃털" }, { word: "nest", meaning: "둥지; 집, 보금자리" }, { word: "cage", meaning: "우리, 새장" }, { word: "snake", meaning: "뱀" }, { word: "lizard", meaning: "도마뱀" }, { word: "shark", meaning: "상어" }
            ],
            "Unit 34": [
                { word: "plant", meaning: "식물, 초목, 나무; 공장; 심다" }, { word: "maple", meaning: "단풍나무" }, { word: "olive", meaning: "올리브; 올리브나무" }, { word: "rose", meaning: "장미" }, { word: "bloom", meaning: "꽃을 피우다, 꽃이 피다" }, { word: "berry", meaning: "산딸기류 열매, -베리" }, { word: "cactus", meaning: "선인장" }, { word: "cucumber", meaning: "오이" }, { word: "pumpkin", meaning: "호박" }, { word: "mushroom", meaning: "버섯" }, { word: "seed", meaning: "씨, 씨앗" }, { word: "root", meaning: "뿌리; 근원, 핵심" }, { word: "branch", meaning: "나뭇가지; 지사, 분점" }, { word: "stick", meaning: "나무토막, 나뭇가지; 막대기; 찌르다; 달라붙다" }, { word: "leaf", meaning: "잎" }, { word: "straw", meaning: "짚, 밀짚, 지푸라기; 빨대" }, { word: "insect", meaning: "곤충" }, { word: "bug", meaning: "벌레, 작은 곤충" }, { word: "worm", meaning: "벌레; 기생충" }, { word: "beetle", meaning: "딱정벌레" }, { word: "butterfly", meaning: "나비; (수영의) 접영" }, { word: "mosquito", meaning: "모기" }, { word: "spider", meaning: "거미" }, { word: "web", meaning: "거미줄; (복잡하게 연결된) -망" }, { word: "shell", meaning: "껍데기, 껍질; 조가비 모양의 것" }
            ],
            "Unit 35": [
                { word: "universe", meaning: "우주, 은하계" }, { word: "galaxy", meaning: "은하계; 은하수" }, { word: "consist", meaning: "이루어져 있다" }, { word: "numerous", meaning: "많은" }, { word: "float", meaning: "뜨다; 떠다니다, 떠돌다" }, { word: "planet", meaning: "행성" }, { word: "comet", meaning: "혜성" }, { word: "earth", meaning: "지구; 땅, 지면; 흙" }, { word: "gravity", meaning: "(지구) 중력" }, { word: "exist", meaning: "존재하다, 실재하다" }, { word: "solar", meaning: "태양의; 태양열을 이용한" }, { word: "lunar", meaning: "달의" }, { word: "flash", meaning: "(잠깐) 비치다, 번쩍이다; 번쩍임" }, { word: "burst", meaning: "터지다, 폭발하다" }, { word: "observe", meaning: "관찰하다, 관측하다" }, { word: "spaceship", meaning: "우주선" }, { word: "rocket", meaning: "로켓; 치솟다, 급증하다" }, { word: "astronaut", meaning: "우주 비행사" }, { word: "shuttle", meaning: "우주 왕복선" }, { word: "launch", meaning: "시작하다, 개시하다; (우주선 등을) 발사하다; 개시, 출시, 발사" }, { word: "explore", meaning: "탐험하다, 탐구하다" }, { word: "footprint", meaning: "발자국" }, { word: "discover", meaning: "발견하다; (무엇에 대한 정보를) 찾다, 알아내다" }, { word: "detect", meaning: "탐지하다, 감지하다" }, { word: "alien", meaning: "외계인; 외계의" }
            ],
            "Unit 36": [
                { word: "number", meaning: "수, 숫자; 번호" }, { word: "amount", meaning: "양; 총액; (금액이) ~ 되다" }, { word: "couple", meaning: "두 개, 두 사람; 커플, 부부" }, { word: "double", meaning: "두 배의; 두 배로 만들다" }, { word: "half", meaning: "절반, 2분의 1; 30분" }, { word: "extra", meaning: "추가의, 여분의, 임시의" }, { word: "enough", meaning: "필요한 만큼의, 충분한; 충분히" }, { word: "same", meaning: "(똑)같은, 동일한; 똑같이 (the ~)" }, { word: "few", meaning: "(수가) 많지 않은[적은]" }, { word: "bit", meaning: "조금, 약간" }, { word: "any", meaning: "어떤, 어느, 무슨; 아무(것); 전혀, 조금도" }, { word: "nothing", meaning: "아무것도 (~아니다), 아무것도 아닌 것" }, { word: "only", meaning: "유일한; 단지, 오직" }, { word: "centimeter/centimetre", meaning: "센티미터" }, { word: "kilogram/kilogramme", meaning: "킬로그램 (1,000그램)" }, { word: "mile", meaning: "<거리 단위>마일 (1,609m)" }, { word: "piece", meaning: "한 조각, 한 부분 (자르거나 나눠 놓은 것); (깨어진) 조각" }, { word: "pair", meaning: "한 쌍, 한 짝" }, { word: "count", meaning: "수를 세다; 계산하다" }, { word: "add", meaning: "더하다, 추가하다" }, { word: "plus", meaning: "더하기, 플러스; ~이상의" }, { word: "divide", meaning: "나누다, 갈라지다" }, { word: "increase", meaning: "증가하다; 증가" }, { word: "measure", meaning: "재다, 측정하다; 조치, 대책; (어떤 것의) 양, 정도" }, { word: "weigh", meaning: "무게를 달다, 체중을 달다; 무게가 ~이다" }
            ],
            "Unit 37": [
                { word: "hour", meaning: "1시간" }, { word: "minute", meaning: "<시간 단위>분; 잠깐" }, { word: "second", meaning: "<시간 단위> 초; 잠시, 순간; 두 번째의" }, { word: "noon", meaning: "정오, 한낮" }, { word: "evening", meaning: "저녁, 밤, 야간" }, { word: "tonight", meaning: "오늘 밤에; 오늘 밤" }, { word: "present", meaning: "현재, 지금; 선물; 현재의; 참석한" }, { word: "future", meaning: "미래, 장래; 미래의" }, { word: "moment", meaning: "순간, 잠깐; (어떤 일이 일어난) 때, 시기" }, { word: "forever", meaning: "영원히" }, { word: "early", meaning: "이른, 빠른; 일찍, 빨리" }, { word: "late", meaning: "늦은, 지각한; 늦게" }, { word: "soon", meaning: "곧, 머지않아, 이내; 빨리" }, { word: "since", meaning: "~ 이후 계속; ~ 이후로; ~ 때문에, ~이므로" }, { word: "almost", meaning: "거의, 대부분" }, { word: "date", meaning: "날짜; 데이트" }, { word: "everyday", meaning: "매일의, 일상의" }, { word: "yesterday", meaning: "어제; 어제" }, { word: "tomorrow", meaning: "내일; 내일, 미래" }, { word: "week", meaning: "주, 일주일" }, { word: "weekend", meaning: "주말" }, { word: "month", meaning: "달, 월" }, { word: "last", meaning: "마지막의; 지난, 가장 최근의; 계속되다, 지속되다; 마지막 사람[물건]" }, { word: "final", meaning: "마지막의, 최종의; 최종적인; 결승전" }, { word: "end", meaning: "끝, 말; 끝나다" }
            ],
            "Unit 38": [
                { word: "object", meaning: "물체, 물건; 목적, 목표; 반대하다" }, { word: "type", meaning: "유형, 종류; (컴퓨터로) 타자 치다, 입력하다" }, { word: "describe", meaning: "묘사하다, 설명하다" }, { word: "shape", meaning: "모양, 형태; 몸매, 체형" }, { word: "circle", meaning: "원, 동그라미; (특히 공중에서) 빙빙 돌다" }, { word: "round", meaning: "둥근, 원형의; 한 차례, 한 회" }, { word: "square", meaning: "정사각형 모양의; 정사각형; 광장" }, { word: "flat", meaning: "평평한; 납작한; 타이어가 펑크 난" }, { word: "line", meaning: "선, 줄" }, { word: "sharp", meaning: "날카로운, 뾰족한; 급격한" }, { word: "size", meaning: "크기, 규모" }, { word: "large", meaning: "(규모가) 큰, (양이) 많은" }, { word: "giant", meaning: "(이야기 속의) 거인; 거대한" }, { word: "huge", meaning: "거대한, 엄청난" }, { word: "tiny", meaning: "아주 작은, 아주 적은" }, { word: "wide", meaning: "(폭이) 넓은" }, { word: "deep", meaning: "깊은; 깊이가 ~인" }, { word: "short", meaning: "짧은; 키가 작은; 부족한" }, { word: "white", meaning: "흰색의, 하얀; 흰색" }, { word: "green", meaning: "초록색의; 환경 보호의; 초록색" }, { word: "gray/grey", meaning: "회색, 쥐색; 회색의, 쥐색의" }, { word: "silver", meaning: "은; 은빛, 은색; 은색의" }, { word: "metal", meaning: "금속" }, { word: "bright", meaning: "밝은; 똑똑한; 밝게, 환히" }, { word: "dark", meaning: "어두운, 캄캄한; 어둠" }
            ],
            "Unit 39": [
                { word: "clean", meaning: "깨끗한, 깔끔한; 청소하다, 닦다" }, { word: "dirty", meaning: "더러운, 지저분한" }, { word: "fast", meaning: "빠른; 빠르게, 빨리" }, { word: "quick", meaning: "빠른, 신속한; 빨리, 신속히" }, { word: "slow", meaning: "느린; 느리게, 천천히" }, { word: "hard", meaning: "단단한, 굳은, 딱딱한; 어려운, 힘든; 열심히 하는; 열심히; 세게" }, { word: "soft", meaning: "부드러운, 푹신한" }, { word: "cheap", meaning: "값싼" }, { word: "expensive", meaning: "값비싼" }, { word: "different", meaning: "다른, 차이가 나는; 여러 가지의" }, { word: "similar", meaning: "비슷한, 유사한, 닮은" }, { word: "everything", meaning: "모든 것, 모두" }, { word: "anything", meaning: "무엇, 아무것; 무엇이든" }, { word: "heavy", meaning: "무거운; (양이) 많은, 심한" }, { word: "dry", meaning: "마른, 건조한; (날이) 가문, 비가 오지 않는; 마르다, 말리다" }, { word: "open", meaning: "열린; 개방된; 열다; (눈을) 뜨다, (입을) 벌리다; 개업하다" }, { word: "quiet", meaning: "조용한, 고요한" }, { word: "popular", meaning: "인기 있는; 대중의, 대중적인" }, { word: "simple", meaning: "단순한, 간단한" }, { word: "empty", meaning: "빈, 비어 있는" }, { word: "precious", meaning: "귀중한, 값비싼" }, { word: "special", meaning: "특별한" }, { word: "unique", meaning: "유일한, 독특한" }, { word: "perfect", meaning: "완벽한" }, { word: "useful", meaning: "유용한, 도움이 되는" }
            ],
            "Unit 40": [
                { word: "meantime", meaning: "그동안에, 그 사이에; 한편" }, { word: "ever", meaning: "한 번이라도; 언제나, 항상" }, { word: "maybe", meaning: "어쩌면, 아마" }, { word: "perhaps", meaning: "아마, 어쩌면" }, { word: "actually", meaning: "실제로; 실은, 사실은" }, { word: "already", meaning: "이미, 벌써" }, { word: "nearly", meaning: "거의" }, { word: "anyway", meaning: "게다가; 그래도; 어쨌든" }, { word: "instead", meaning: "대신에" }, { word: "always", meaning: "항상, 언제나" }, { word: "often", meaning: "흔히, 자주" }, { word: "sometimes", meaning: "때때로, 가끔" }, { word: "never", meaning: "결코 ~않다, 전혀 ~아니다" }, { word: "either", meaning: "각각의, 양쪽의; (둘 중) 어느 하나; (둘 중에서 선택을 할 때) ~나[든]" }, { word: "neither", meaning: "어느 쪽의 ~도 아니다, 어느 쪽도 ~이 아니다" }, { word: "else", meaning: "또 다른, 그 밖의 다른; 그 밖에, 다른" }, { word: "such", meaning: "그런, 그러한" }, { word: "likely", meaning: "~할[일] 것 같은" }, { word: "unlike", meaning: "~과 달리; ~과 다른" }, { word: "against", meaning: "~에 반대하여, ~에 맞서" }, { word: "besides", meaning: "~이외에; 게다가, 그밖에" }, { word: "during", meaning: "~ 동안에, ~ 사이에" }, { word: "although", meaning: "(비록) ~이긴 하지만" }, { word: "whether", meaning: "~인지 (아닌지); ~이든 (아니든)" }, { word: "nor", meaning: "~도 (또한) 아니다" }
            ]
        };
        // --- 이하 스크립트 코드는 이전 앱들과 동일 ---
        let userInfo = {};
        let currentUnit='',questions=[],currentQuestionIndex=0,userAnswers=[],timerInterval;
        const userInfoScreen = document.getElementById('user-info-screen');
        const unitSelectionScreen=document.getElementById('unit-selection-screen');
        const testScreen=document.getElementById('test-screen');
        const resultsScreen=document.getElementById('results-screen');
        const schoolInput = document.getElementById('school-input');
        const gradeInput = document.getElementById('grade-input');
        const nameInput = document.getElementById('name-input');
        const startAppButton = document.getElementById('start-app-button');
        const unitButtonsContainer=document.getElementById('unit-buttons');
        const testTitle=document.getElementById('test-title');
        const timerDisplay=document.getElementById('timer');
        const progressBar=document.getElementById('progress-bar');
        const progressText=document.getElementById('progress-text');
        const questionType=document.getElementById('question-type');
        const questionEl=document.getElementById('question');
        const answerInput=document.getElementById('answer-input');
        const nextButton=document.getElementById('next-button');
        const finalScore=document.getElementById('final-score');
        const incorrectAnswersBody=document.getElementById('incorrect-answers-body');
        const saveResultsButton=document.getElementById('save-results-button');
        const retryButton=document.getElementById('retry-button');
        const homeButton=document.getElementById('home-button');
        
        function init(){
            Object.keys(vocabularyData).sort((a,b)=>parseInt(a.match(/\d+/)[0])-parseInt(b.match(/\d+/)[0])).forEach(unit=>{const button=document.createElement('button');button.textContent=unit;button.className='bg-white text-gray-700 font-semibold py-4 px-2 rounded-lg shadow hover:bg-gray-200 border border-gray-200 transition-all duration-200';button.onclick=()=>startTest(unit);unitButtonsContainer.appendChild(button)});
            startAppButton.addEventListener('click', startApp);
            nextButton.addEventListener('click',handleNext);
            answerInput.addEventListener('keyup',e=>{if(e.key==='Enter'){handleNext()}});
            retryButton.addEventListener('click',()=>startTest(currentUnit));
            homeButton.addEventListener('click',()=>showScreen(unitSelectionScreen));
            saveResultsButton.addEventListener('click',saveResults);
            showScreen(userInfoScreen);
        }

        function startApp() {
            const school = schoolInput.value.trim();
            const grade = gradeInput.value.trim();
            const name = nameInput.value.trim();
            if (!school || !grade || !name) {
                showToast("모든 정보를 입력해주세요.");
                return;
            }
            userInfo = { school, grade, name };
            showScreen(unitSelectionScreen);
        }

        function showScreen(screen){
            [userInfoScreen, unitSelectionScreen,testScreen,resultsScreen].forEach(s=>s.classList.add('hidden'));
            screen.classList.remove('hidden');
        }

        async function saveResults(){
            const score=finalScore.textContent;
            let title = `${userInfo.school} ${userInfo.grade}학년 ${userInfo.name}의 ${currentUnit} 시험지`;
            let resultsText = `${title}\n\n총점: ${score}점\n\n--- 틀린 문제 목록 ---\n`;
            const incorrectRows=incorrectAnswersBody.querySelectorAll('tr');
            if(incorrectRows.length===1&&incorrectRows[0].children[0].colSpan===4){
                resultsText+="틀린 문제가 없습니다."
            } else {
                incorrectRows.forEach(row=>{
                    const cells=row.querySelectorAll('td');
                    resultsText+=`문제: ${cells[0].textContent}\n`;
                    resultsText+=`제출 답: ${cells[1].textContent}\n`;
                    resultsText+=`정답: ${cells[2].textContent}\n`;
                    resultsText+=`점수: ${cells[3].textContent}\n\n`;
                });
            }
            try{
                await navigator.clipboard.writeText(resultsText.trim());
                showToast('시험 결과가 클립보드에 복사되었습니다.');
            } catch(err) {
                console.error('클립보드 복사 실패:',err);
                showToast('결과 복사에 실패했습니다.');
            }
        }
        
        function startTest(unit){currentUnit=unit;let unitWords=[...vocabularyData[unit]];questions=[];userAnswers=[];currentQuestionIndex=0;unitWords.sort(()=>0.5-Math.random());const numQuestions=Math.min(20,unitWords.length);const selectedWords=unitWords.slice(0,numQuestions);const half=Math.ceil(numQuestions/2);for(let i=0;i<numQuestions;i++){const wordData=selectedWords[i];const type=i<half?'spelling':'meaning';questions.push({type:type,word:wordData.word,meaning:wordData.meaning,originalQuestion:type==='spelling'?wordData.meaning:wordData.word})}
        questions.sort(()=>0.5-Math.random());testTitle.textContent=`${unit} 단어 시험`;showScreen(testScreen);displayQuestion();startTimer()}
        function displayQuestion(){if(currentQuestionIndex>=questions.length){submitTest();return}
        const q=questions[currentQuestionIndex];if(q.type==='spelling'){questionType.textContent='의미를 보고 철자 맞히기';questionEl.textContent=q.meaning.replace(/(\d+\.\s*)|[()]/g,'').replace(/;/g,', ')}else{questionType.textContent='철자를 보고 의미 맞히기';questionEl.textContent=q.word}
        answerInput.value='';answerInput.focus();updateProgress();if(currentQuestionIndex===questions.length-1){nextButton.textContent='채점하기'}else{nextButton.textContent='다음'}}
        function handleNext(){const answer=answerInput.value.trim();if(!answer){answerInput.classList.add('incorrect-flash');setTimeout(()=>answerInput.classList.remove('incorrect-flash'),500);return}
        userAnswers[currentQuestionIndex]=answer;const isCorrectAnswer=isAnswerInitiallyCorrect(questions[currentQuestionIndex],answer);answerInput.classList.add(isCorrectAnswer?'correct-flash':'incorrect-flash');setTimeout(()=>answerInput.classList.remove('correct-flash','incorrect-flash'),500);setTimeout(()=>{currentQuestionIndex++;displayQuestion()},300)}
        function isAnswerInitiallyCorrect(question,answer){if(question.type==='spelling'){return question.word.toLowerCase()===answer.toLowerCase()}else{const cleanCorrectAnswer=question.meaning.toLowerCase().replace(/(\d+\.\s*)|[()]/g,'');const userFirstMeaning=answer.split(/[,;]/)[0].toLowerCase().trim();return cleanCorrectAnswer.includes(userFirstMeaning)}}
        function updateProgress(){const progress=((currentQuestionIndex)/questions.length)*100;progressBar.style.width=`${progress}%`;progressText.textContent=`문제 ${currentQuestionIndex+1} / ${questions.length}`}
        function startTimer(){let timeLeft=600;timerDisplay.textContent="10:00";clearInterval(timerInterval);timerInterval=setInterval(()=>{timeLeft--;const minutes=Math.floor(timeLeft/60);const seconds=timeLeft%60;timerDisplay.textContent=`${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;if(timeLeft<=0){clearInterval(timerInterval);submitTest()}},1000)}
        function submitTest(){clearInterval(timerInterval);let totalScore=0;const incorrectAnswers=[];questions.forEach((q,index)=>{const userAnswer=userAnswers[index]||"";let score=0;if(q.type==='spelling'){score=userAnswer.toLowerCase()===q.word.toLowerCase()?100:0}else{score=calculateMeaningScore(userAnswer,q.meaning)}
        if(score<100){incorrectAnswers.push({question:q.originalQuestion,userAnswer:userAnswer||"미응답",correctAnswer:q.type==='spelling'?q.word:q.meaning,score:score})}
        totalScore+=score});const averageScore=questions.length>0?Math.round(totalScore/questions.length):0;displayResults(averageScore,incorrectAnswers)}
        function calculateMeaningScore(userAnswer,correctAnswer){const normalize=str=>str.toLowerCase().replace(/[()]/g,'').trim();const cleanCorrectAnswer=correctAnswer.replace(/\d+\.\s*/g,'').trim();const cleanUserAnswer=userAnswer.trim();if(cleanUserAnswer==="")return 0;const meaningGroups=cleanCorrectAnswer.split(';').map(g=>g.trim().split(',').map(s=>normalize(s)).filter(s=>s));const userMeanings=cleanUserAnswer.split(/[,;]/).map(m=>normalize(m)).filter(m=>m);const allPossibleCorrectMeanings=new Set(meaningGroups.flat());for(const userMeaning of userMeanings){let isMeaningValid=false;for(const correctMeaning of allPossibleCorrectMeanings){if(correctMeaning.includes(userMeaning)||userMeaning.includes(correctMeaning)){isMeaningValid=true;break}}
        if(!isMeaningValid){return 0}}
        let matchedGroupsCount=0;for(const group of meaningGroups){let isGroupMatched=false;for(const userMeaning of userMeanings){for(const similarMeaning of group){if(similarMeaning.includes(userMeaning)||userMeaning.includes(similarMeaning)){isGroupMatched=true;break}}
        if(isGroupMatched)break}
        if(isGroupMatched){matchedGroupsCount++}}
        if(meaningGroups.length===0)return 100;const matchedRatio=matchedGroupsCount/meaningGroups.length;if(matchedRatio>=1){return 100}else if(matchedRatio>=0.5){return 50}else{return 0}}
        function displayResults(score,incorrectList){finalScore.textContent=score;const scoreContainer=finalScore.parentElement;scoreContainer.className='text-5xl font-bold text-center py-8 mb-6 rounded-lg';if(score>=80){scoreContainer.classList.add('text-blue-600')}else if(score>=50){scoreContainer.classList.add('text-yellow-600')}else{scoreContainer.classList.add('text-red-600')}
        incorrectAnswersBody.innerHTML='';if(incorrectList.length===0){incorrectAnswersBody.innerHTML=`<tr><td colspan="4" class="text-center py-4 text-gray-500">틀린 문제가 없습니다! 완벽해요!</td></tr>`}else{incorrectList.forEach(item=>{const row=`<tr class="text-sm"><td class="px-4 py-3 align-top">${item.question}</td><td class="px-4 py-3 align-top text-red-600">${item.userAnswer}</td><td class="px-4 py-3 align-top text-blue-600">${item.correctAnswer}</td><td class="px-4 py-3 align-top font-semibold">${item.score}점</td></tr>`;incorrectAnswersBody.innerHTML+=row})}
        showScreen(resultsScreen)}
        function showToast(message){const toast=document.getElementById('toast');toast.textContent=message;toast.classList.remove('opacity-0','translate-y-5');setTimeout(()=>{toast.classList.add('opacity-0','translate-y-5')},2500)}
        init();
    </script>
</body>
</html>

