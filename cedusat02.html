<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>어휘끝 수능 단어 시험 (Unit 11-20)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        .correct-flash { animation: flash-green 0.5s; }
        .incorrect-flash { animation: flash-red 0.5s; }
        @keyframes flash-green { 50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.5); } }
        @keyframes flash-red { 50% { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.5); } }
        #toast { transition: opacity 0.3s, transform 0.3s; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen font-sans">
    <div id="app-container" class="w-full max-w-2xl mx-auto bg-white shadow-xl rounded-lg p-4 sm:p-8">
        
        <!-- NEW: 사용자 정보 입력 화면 -->
        <div id="user-info-screen">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">사용자 정보 입력</h1>
            <p class="text-center text-gray-600 mb-8">결과 저장에 사용될 정보를 입력해주세요.</p>
            <div class="space-y-4">
                <div>
                    <label for="school-input" class="block text-sm font-medium text-gray-700">학교</label>
                    <input type="text" id="school-input" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="예: 새싹고등학교">
                </div>
                <div>
                    <label for="grade-input" class="block text-sm font-medium text-gray-700">학년</label>
                    <input type="text" id="grade-input" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="예: 3">
                </div>
                <div>
                    <label for="name-input" class="block text-sm font-medium text-gray-700">이름</label>
                    <input type="text" id="name-input" class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm" placeholder="예: 홍길동">
                </div>
            </div>
            <button id="start-app-button" class="w-full mt-8 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition-colors duration-300">시험 시작하기</button>
        </div>

        <!-- 1. 유닛 선택 화면 (이제 hidden) -->
        <div id="unit-selection-screen" class="hidden">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">어휘끝 수능 단어 시험</h1>
            <p class="text-center text-gray-600 mb-8">시험 볼 유닛을 선택하세요. (Unit 11-20)</p>
            <div id="unit-buttons" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
        </div>
        
        <!-- 2. 단어 시험 화면 (HTML 구조 동일) -->
        <div id="test-screen" class="hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 id="test-title" class="text-xl sm:text-2xl font-bold text-gray-800"></h2>
                <div id="timer" class="text-lg font-semibold text-red-500 bg-red-100 px-4 py-2 rounded-lg">10:00</div>
            </div>
            <div class="mb-6">
                <div class="w-full bg-gray-200 rounded-full h-2.5"><div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300"></div></div>
                <p id="progress-text" class="text-center text-sm text-gray-600 mt-2"></p>
            </div>
            <div id="question-container" class="text-center p-6 bg-gray-50 rounded-lg">
                <p id="question-type" class="text-sm font-semibold text-blue-600 mb-2"></p>
                <p id="question" class="text-2xl sm:text-3xl font-medium text-gray-900 mb-6 min-h-[72px] flex items-center justify-center"></p>
                <input type="text" id="answer-input" class="w-full p-3 border border-gray-300 rounded-lg text-lg text-center focus:ring-2 focus:ring-blue-500" placeholder="정답을 입력하세요">
            </div>
            <button id="next-button" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700">다음</button>
        </div>

        <!-- 3. 채점 결과 화면 (HTML 구조 동일) -->
        <div id="results-screen" class="hidden">
            <h2 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-4">시험 결과</h2>
            <div id="score-container" class="text-5xl font-bold text-center py-8 mb-6 rounded-lg">
                <span id="final-score"></span><span class="text-3xl text-gray-500"> / 100</span>
            </div>
            <h3 class="text-lg font-semibold text-gray-700 mb-4">틀린 문제 목록</h3>
            <div class="overflow-x-auto border border-gray-200 rounded-lg max-h-64">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0"><tr><th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">문제</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">제출한 답</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">정답</th><th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">점수</th></tr></thead>
                    <tbody id="incorrect-answers-body" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button id="save-results-button" class="w-full bg-green-500 text-white font-bold py-3 rounded-lg hover:bg-green-600">결과 저장</button>
                <button id="retry-button" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg hover:bg-blue-600">다시 풀기</button>
                <button id="home-button" class="w-full bg-gray-500 text-white font-bold py-3 rounded-lg hover:bg-gray-600">처음으로</button>
            </div>
        </div>
    </div>
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-5 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-5"></div>
    <script>
        const vocabularyData = {
            "Unit 11": [ { word: "mobile", meaning: "이동하는, 이동식의; 휴대폰" }, { word: "motive", meaning: "동기, 자극; 움직이게 하는" }, { word: "emotion", meaning: "감정, 정서" }, { word: "promote", meaning: "1. 승진시키다; 2. 촉진하다; 3. 홍보하다" }, { word: "remote", meaning: "먼, 외딴" }, { word: "moment", meaning: "순간, 찰나" }, { word: "motion", meaning: "운동, 움직임" }, { word: "remove", meaning: "제거하다, 없애다" }, { word: "modify", meaning: "변경하다, 수정하다" }, { word: "accommodate", meaning: "1. 수용하다, 숙박시키다; 2. 편의를 도모하다" }, { word: "commodity", meaning: "상품, 원자재" }, { word: "mold", meaning: "1. 틀, 형; 2. 곰팡이; 틀에 넣어 만들다" }, { word: "mortal", meaning: "죽을 운명의, 치명적인" }, { word: "mortgage", meaning: "저당, 주택 담보 대출" }, { word: "murder", meaning: "살인(하다)" } ],
            "Unit 12": [ { word: "move", meaning: "움직이다, 이사하다; 조치" }, { word: "community", meaning: "공동체" }, { word: "communicate", meaning: "의사소통하다" }, { word: "common", meaning: "흔한, 공통의" }, { word: "native", meaning: "원주민의, 타고난" }, { word: "nation", meaning: "국가, 민족" }, { word: "nature", meaning: "자연; 본성" }, { word: "negative", meaning: "부정적인" }, { word: "deny", meaning: "부인하다, 거절하다" }, { word: "neutral", meaning: "중립의" }, { word: "norm", meaning: "규범, 표준" }, { word: "enormous", meaning: "거대한, 막대한" }, { word: "normal", meaning: "정상적인, 보통의" }, { word: "note", meaning: "주목하다, 메모하다; 메모, 지폐, 음표" }, { word: "notice", meaning: "알아차리다; 주목, 공지" }, { word: "notify", meaning: "알리다, 통지하다" }, { word: "notion", meaning: "개념, 관념" }, { word: "announce", meaning: "발표하다, 알리다" }, { word: "pronounce", meaning: "발음하다, 선언하다" } ],
            "Unit 13": [ { word: "novel", meaning: "소설; 새로운, 신기한" }, { word: "renew", meaning: "갱신하다, 재개하다" }, { word: "nutrition", meaning: "영양" }, { word: "nourish", meaning: "영양분을 공급하다, 기르다" }, { word: "nurse", meaning: "간호사; 간호하다" }, { word: "melody", meaning: "멜로디, 선율" }, { word: "comedy", meaning: "희극, 코미디" }, { word: "tragedy", meaning: "비극" }, { word: "operate", meaning: "작동하다, 수술하다" }, { word: "cooperate", meaning: "협력하다, 협동하다" }, { word: "option", meaning: "선택(권)" }, { word: "adopt", meaning: "입양하다, 채택하다" }, { word: "opinion", meaning: "의견, 생각" }, { word: "oral", meaning: "구두의, 입의" }, { word: "oracle", meaning: "신탁, 예언자" } ],
            "Unit 14": [ { word: "ordinary", meaning: "보통의, 평범한" }, { word: "subordinate", meaning: "하급의, 종속된; 부하" }, { word: "origin", meaning: "기원, 출신" }, { word: "orient", meaning: "동양; 향하게 하다, 적응시키다" }, { word: "prepare", meaning: "준비하다" }, { word: "apparatus", meaning: "장치, 기구" }, { word: "emperor", meaning: "황제" }, { word: "imperial", meaning: "제국의, 황제의" }, { word: "compare", meaning: "비교하다" }, { word: "peer", meaning: "동료, 또래; 자세히 들여다보다" }, { word: "apparent", meaning: "분명한, 명백한" }, { word: "appear", meaning: "나타나다, ~인 것 같다" }, { word: "transparent", meaning: "투명한, 명백한" }, { word: "partial", meaning: "부분적인, 편파적인" }, { word: "particle", meaning: "입자, 미립자" }, { word: "apart", meaning: "떨어져, 따로" }, { word: "portion", meaning: "부분, 1인분" }, { word: "proportion", meaning: "비율, 균형" } ],
            "Unit 15": [ { word: "passage", meaning: "통로, 구절" }, { word: "passenger", meaning: "승객" }, { word: "passerby", meaning: "통행인" }, { word: "pastime", meaning: "취미, 오락" }, { word: "pace", meaning: "속도, 걸음" }, { word: "pathetic", meaning: "불쌍한, 애처로운" }, { word: "patient", meaning: "환자; 인내심 있는" }, { word: "passion", meaning: "열정" }, { word: "compassion", meaning: "연민, 동정심" }, { word: "pattern", meaning: "패턴, 양식" }, { word: "patron", meaning: "후원자, 단골손님" }, { word: "pedestrian", meaning: "보행자; 보행자의" }, { word: "expedition", meaning: "탐험, 원정" }, { word: "compel", meaning: "강요하다" }, { word: "expel", meaning: "쫓아내다, 추방하다" }, { word: "appeal", meaning: "호소하다, 항소하다; 매력, 호소" }, { word: "impulse", meaning: "충동" }, { word: "penalty", meaning: "처벌, 벌금" }, { word: "painful", meaning: "고통스러운" }, { word: "punish", meaning: "처벌하다" } ],
            "Unit 16": [ { word: "depend", meaning: "의존하다, ~에 달려있다" }, { word: "suspend", meaning: "매달다, 중단하다" }, { word: "compensate", meaning: "보상하다, 보충하다" }, { word: "pension", meaning: "연금" }, { word: "ponder", meaning: "숙고하다, 곰곰이 생각하다" }, { word: "experience", meaning: "경험; 경험하다" }, { word: "experiment", meaning: "실험; 실험하다" }, { word: "expert", meaning: "전문가" }, { word: "peril", meaning: "위험" }, { word: "compete", meaning: "경쟁하다" }, { word: "competence", meaning: "능력, 역량" }, { word: "petition", meaning: "탄원(서), 청원" }, { word: "appetite", meaning: "식욕, 욕구" }, { word: "repeat", meaning: "반복하다" }, { word: "phantom", meaning: "유령, 환영" }, { word: "fantasy", meaning: "공상, 환상" }, { word: "fantastic", meaning: "환상적인, 멋진" }, { word: "phase", meaning: "단계, 국면" }, { word: "emphasize", meaning: "강조하다" } ],
            "Unit 17": [ { word: "applause", meaning: "박수갈채" }, { word: "explode", meaning: "폭발하다" }, { word: "complete", meaning: "완료하다; 완벽한" }, { word: "complement", meaning: "보완물, 보어; 보완하다" }, { word: "implement", meaning: "시행하다; 도구" }, { word: "compliment", meaning: "칭찬; 칭찬하다" }, { word: "supply", meaning: "공급하다; 공급" }, { word: "plenty", meaning: "풍부함, 많음" }, { word: "please", meaning: "기쁘게 하다; 제발" }, { word: "plead", meaning: "간청하다, 변호하다" }, { word: "complex", meaning: "복잡한; 복합건물" }, { word: "perplex", meaning: "당혹하게 하다" }, { word: "imply", meaning: "암시하다, 내포하다" }, { word: "apply", meaning: "적용하다, 지원하다" }, { word: "diplomatic", meaning: "외교의" }, { word: "employ", meaning: "고용하다" }, { word: "exploit", meaning: "이용하다, 착취하다; 위업" } ],
            "Unit 18": [ { word: "deplore", meaning: "개탄하다, 한탄하다" }, { word: "explore", meaning: "탐험하다" }, { word: "political", meaning: "정치적인" }, { word: "policy", meaning: "정책, 방침" }, { word: "metropolis", meaning: "대도시, 중심지" }, { word: "popular", meaning: "인기 있는, 대중적인" }, { word: "populate", meaning: "거주시키다, 살다" }, { word: "public", meaning: "대중의, 공공의; 대중" }, { word: "publish", meaning: "출판하다, 발표하다" }, { word: "republic", meaning: "공화국" }, { word: "export", meaning: "수출하다; 수출" }, { word: "import", meaning: "수입하다; 수입" }, { word: "transport", meaning: "수송하다; 수송" }, { word: "portable", meaning: "휴대용의" }, { word: "opportunity", meaning: "기회" }, { word: "pose", meaning: "자세를 취하다; 제기하다" }, { word: "compose", meaning: "구성하다, 작곡하다" }, { word: "depose", meaning: "퇴위시키다, 물러나게 하다" }, { word: "deposit", meaning: "두다, 예금하다; 보증금" }, { word: "expose", meaning: "드러내다, 노출시키다" } ],
            "Unit 19": [ { word: "impose", meaning: "부과하다, 강요하다" }, { word: "oppose", meaning: "반대하다" }, { word: "propose", meaning: "제안하다, 청혼하다" }, { word: "suppose", meaning: "가정하다, 생각하다" }, { word: "purpose", meaning: "목적" }, { word: "component", meaning: "구성 요소" }, { word: "opponent", meaning: "상대, 반대자" }, { word: "compound", meaning: "합성물; 합성의; 악화시키다" }, { word: "possible", meaning: "가능한" }, { word: "possess", meaning: "소유하다" }, { word: "potential", meaning: "잠재적인; 잠재력" }, { word: "precious", meaning: "귀중한" }, { word: "appreciate", meaning: "1. 감사하다; 2. 감상하다; 3. 가치를 인정하다" }, { word: "praise", meaning: "칭찬하다; 칭찬" }, { word: "interpret", meaning: "해석하다, 통역하다" }, { word: "price", meaning: "가격" } ],
            "Unit 20": [ { word: "prison", meaning: "감옥" }, { word: "imprison", meaning: "투옥하다" }, { word: "enterprise", meaning: "기업, 사업" }, { word: "surprise", meaning: "놀라게 하다; 놀람" }, { word: "prey", meaning: "먹이" }, { word: "comprehend", meaning: "이해하다, 포함하다" }, { word: "apprehend", meaning: "체포하다; 염려하다; 이해하다" }, { word: "probable", meaning: "아마도, 그럴듯한" }, { word: "probe", meaning: "조사하다, 탐사하다" }, { word: "prove", meaning: "증명하다, 입증하다" }, { word: "approve", meaning: "승인하다, 찬성하다" }, { word: "proper", meaning: "적절한, 알맞은" }, { word: "property", meaning: "재산, 소유물; 특성" }, { word: "appropriate", meaning: "적절한; 도용하다" }, { word: "punctual", meaning: "시간을 엄수하는" }, { word: "punctuate", meaning: "구두점을 찍다" }, { word: "disappoint", meaning: "실망시키다" } ]
        };
        // --- 이하 스크립트 코드 수정 ---
        let userInfo = {};
        let currentUnit='',questions=[],currentQuestionIndex=0,userAnswers=[],timerInterval;
        const userInfoScreen = document.getElementById('user-info-screen');
        const unitSelectionScreen=document.getElementById('unit-selection-screen');
        const testScreen=document.getElementById('test-screen');
        const resultsScreen=document.getElementById('results-screen');
        const schoolInput = document.getElementById('school-input');
        const gradeInput = document.getElementById('grade-input');
        const nameInput = document.getElementById('name-input');
        const startAppButton = document.getElementById('start-app-button');
        const unitButtonsContainer=document.getElementById('unit-buttons');
        const testTitle=document.getElementById('test-title');
        const timerDisplay=document.getElementById('timer');
        const progressBar=document.getElementById('progress-bar');
        const progressText=document.getElementById('progress-text');
        const questionType=document.getElementById('question-type');
        const questionEl=document.getElementById('question');
        const answerInput=document.getElementById('answer-input');
        const nextButton=document.getElementById('next-button');
        const finalScore=document.getElementById('final-score');
        const incorrectAnswersBody=document.getElementById('incorrect-answers-body');
        const saveResultsButton=document.getElementById('save-results-button');
        const retryButton=document.getElementById('retry-button');
        const homeButton=document.getElementById('home-button');
        
        function init(){
            Object.keys(vocabularyData).sort((a,b)=>parseInt(a.match(/\d+/)[0])-parseInt(b.match(/\d+/)[0])).forEach(unit=>{const button=document.createElement('button');button.textContent=unit;button.className='bg-white text-gray-700 font-semibold py-4 px-2 rounded-lg shadow hover:bg-gray-200 border border-gray-200 transition-all duration-200';button.onclick=()=>startTest(unit);unitButtonsContainer.appendChild(button)});
            startAppButton.addEventListener('click', startApp);
            nextButton.addEventListener('click',handleNext);
            answerInput.addEventListener('keyup',e=>{if(e.key==='Enter'){handleNext()}});
            retryButton.addEventListener('click',()=>startTest(currentUnit));
            homeButton.addEventListener('click',()=>showScreen(unitSelectionScreen));
            saveResultsButton.addEventListener('click',saveResults);
            showScreen(userInfoScreen);
        }

        function startApp() {
            const school = schoolInput.value.trim();
            const grade = gradeInput.value.trim();
            const name = nameInput.value.trim();
            if (!school || !grade || !name) {
                showToast("모든 정보를 입력해주세요.");
                return;
            }
            userInfo = { school, grade, name };
            showScreen(unitSelectionScreen);
        }

        function showScreen(screen){
            [userInfoScreen, unitSelectionScreen,testScreen,resultsScreen].forEach(s=>s.classList.add('hidden'));
            screen.classList.remove('hidden');
        }

        async function saveResults(){
            const score=finalScore.textContent;
            let title = `${userInfo.school} ${userInfo.grade}학년 ${userInfo.name}의 ${currentUnit} 시험지`;
            let resultsText = `${title}\n\n총점: ${score}점\n\n--- 틀린 문제 목록 ---\n`;
            const incorrectRows=incorrectAnswersBody.querySelectorAll('tr');
            if(incorrectRows.length===1&&incorrectRows[0].children[0].colSpan===4){
                resultsText+="틀린 문제가 없습니다."
            } else {
                incorrectRows.forEach(row=>{
                    const cells=row.querySelectorAll('td');
                    resultsText+=`문제: ${cells[0].textContent}\n`;
                    resultsText+=`제출 답: ${cells[1].textContent}\n`;
                    resultsText+=`정답: ${cells[2].textContent}\n`;
                    resultsText+=`점수: ${cells[3].textContent}\n\n`;
                });
            }
            try{
                await navigator.clipboard.writeText(resultsText.trim());
                showToast('시험 결과가 클립보드에 복사되었습니다.');
            } catch(err) {
                console.error('클립보드 복사 실패:',err);
                showToast('결과 복사에 실패했습니다.');
            }
        }
        
        // 나머지 JS 함수들은 이전과 동일하게 유지됩니다.
        function startTest(unit){currentUnit=unit;let unitWords=[...vocabularyData[unit]];questions=[];userAnswers=[];currentQuestionIndex=0;unitWords.sort(()=>0.5-Math.random());const numQuestions=Math.min(20,unitWords.length);const selectedWords=unitWords.slice(0,numQuestions);const half=Math.ceil(numQuestions/2);for(let i=0;i<numQuestions;i++){const wordData=selectedWords[i];const type=i<half?'spelling':'meaning';questions.push({type:type,word:wordData.word,meaning:wordData.meaning,originalQuestion:type==='spelling'?wordData.meaning:wordData.word})}
        questions.sort(()=>0.5-Math.random());testTitle.textContent=`${unit} 단어 시험`;showScreen(testScreen);displayQuestion();startTimer()}
        function displayQuestion(){if(currentQuestionIndex>=questions.length){submitTest();return}
        const q=questions[currentQuestionIndex];if(q.type==='spelling'){questionType.textContent='의미를 보고 철자 맞히기';questionEl.textContent=q.meaning.replace(/(\d+\.\s*)|[()]/g,'').replace(/;/g,', ')}else{questionType.textContent='철자를 보고 의미 맞히기';questionEl.textContent=q.word}
        answerInput.value='';answerInput.focus();updateProgress();if(currentQuestionIndex===questions.length-1){nextButton.textContent='채점하기'}else{nextButton.textContent='다음'}}
        function handleNext(){const answer=answerInput.value.trim();if(!answer){answerInput.classList.add('incorrect-flash');setTimeout(()=>answerInput.classList.remove('incorrect-flash'),500);return}
        userAnswers[currentQuestionIndex]=answer;const isCorrectAnswer=isAnswerInitiallyCorrect(questions[currentQuestionIndex],answer);answerInput.classList.add(isCorrectAnswer?'correct-flash':'incorrect-flash');setTimeout(()=>answerInput.classList.remove('correct-flash','incorrect-flash'),500);setTimeout(()=>{currentQuestionIndex++;displayQuestion()},300)}
        function isAnswerInitiallyCorrect(question,answer){if(question.type==='spelling'){return question.word.toLowerCase()===answer.toLowerCase()}else{const cleanCorrectAnswer=question.meaning.toLowerCase().replace(/(\d+\.\s*)|[()]/g,'');const userFirstMeaning=answer.split(/[,;]/)[0].toLowerCase().trim();return cleanCorrectAnswer.includes(userFirstMeaning)}}
        function updateProgress(){const progress=((currentQuestionIndex)/questions.length)*100;progressBar.style.width=`${progress}%`;progressText.textContent=`문제 ${currentQuestionIndex+1} / ${questions.length}`}
        function startTimer(){let timeLeft=600;timerDisplay.textContent="10:00";clearInterval(timerInterval);timerInterval=setInterval(()=>{timeLeft--;const minutes=Math.floor(timeLeft/60);const seconds=timeLeft%60;timerDisplay.textContent=`${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;if(timeLeft<=0){clearInterval(timerInterval);submitTest()}},1000)}
        function submitTest(){clearInterval(timerInterval);let totalScore=0;const incorrectAnswers=[];questions.forEach((q,index)=>{const userAnswer=userAnswers[index]||"";let score=0;if(q.type==='spelling'){score=userAnswer.toLowerCase()===q.word.toLowerCase()?100:0}else{score=calculateMeaningScore(userAnswer,q.meaning)}
        if(score<100){incorrectAnswers.push({question:q.originalQuestion,userAnswer:userAnswer||"미응답",correctAnswer:q.type==='spelling'?q.word:q.meaning,score:score})}
        totalScore+=score});const averageScore=questions.length>0?Math.round(totalScore/questions.length):0;displayResults(averageScore,incorrectAnswers)}
        function calculateMeaningScore(userAnswer,correctAnswer){const normalize=str=>str.toLowerCase().replace(/[()]/g,'').trim();const cleanCorrectAnswer=correctAnswer.replace(/\d+\.\s*/g,'').trim();const cleanUserAnswer=userAnswer.trim();if(cleanUserAnswer==="")return 0;const meaningGroups=cleanCorrectAnswer.split(';').map(g=>g.trim().split(',').map(s=>normalize(s)).filter(s=>s));const userMeanings=cleanUserAnswer.split(/[,;]/).map(m=>normalize(m)).filter(m=>m);const allPossibleCorrectMeanings=new Set(meaningGroups.flat());for(const userMeaning of userMeanings){let isMeaningValid=false;for(const correctMeaning of allPossibleCorrectMeanings){if(correctMeaning.includes(userMeaning)||userMeaning.includes(correctMeaning)){isMeaningValid=true;break}}
        if(!isMeaningValid){return 0}}
        let matchedGroupsCount=0;for(const group of meaningGroups){let isGroupMatched=false;for(const userMeaning of userMeanings){for(const similarMeaning of group){if(similarMeaning.includes(userMeaning)||userMeaning.includes(similarMeaning)){isGroupMatched=true;break}}
        if(isGroupMatched)break}
        if(isGroupMatched){matchedGroupsCount++}}
        if(meaningGroups.length===0)return 100;const matchedRatio=matchedGroupsCount/meaningGroups.length;if(matchedRatio>=1){return 100}else if(matchedRatio>=0.5){return 50}else{return 0}}
        function displayResults(score,incorrectList){finalScore.textContent=score;const scoreContainer=finalScore.parentElement;scoreContainer.className='text-5xl font-bold text-center py-8 mb-6 rounded-lg';if(score>=80){scoreContainer.classList.add('text-blue-600')}else if(score>=50){scoreContainer.classList.add('text-yellow-600')}else{scoreContainer.classList.add('text-red-600')}
        incorrectAnswersBody.innerHTML='';if(incorrectList.length===0){incorrectAnswersBody.innerHTML=`<tr><td colspan="4" class="text-center py-4 text-gray-500">틀린 문제가 없습니다! 완벽해요!</td></tr>`}else{incorrectList.forEach(item=>{const row=`<tr class="text-sm"><td class="px-4 py-3 align-top">${item.question}</td><td class="px-4 py-3 align-top text-red-600">${item.userAnswer}</td><td class="px-4 py-3 align-top text-blue-600">${item.correctAnswer}</td><td class="px-4 py-3 align-top font-semibold">${item.score}점</td></tr>`;incorrectAnswersBody.innerHTML+=row})}
        showScreen(resultsScreen)}
        function showToast(message){const toast=document.getElementById('toast');toast.textContent=message;toast.classList.remove('opacity-0','translate-y-5');setTimeout(()=>{toast.classList.add('opacity-0','translate-y-5')},2500)}
        init();
    </script>
</body>
</html>

