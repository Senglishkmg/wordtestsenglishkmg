<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>어휘끝 중학필수 단어 시험 (Unit 11-20)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }
        .correct-flash { animation: flash-green 0.5s; }
        .incorrect-flash { animation: flash-red 0.5s; }
        @keyframes flash-green { 50% { box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.5); } }
        @keyframes flash-red { 50% { box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.5); } }
        #toast { transition: opacity 0.3s, transform 0.3s; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen font-sans">
    <div id="app-container" class="w-full max-w-2xl mx-auto bg-white shadow-xl rounded-lg p-4 sm:p-8">
        <!-- HTML 구조는 1-10 유닛 앱과 동일 -->
        <div id="user-info-screen">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">사용자 정보 입력</h1>
            <p class="text-center text-gray-600 mb-8">결과 저장에 사용될 정보를 입력해주세요.</p>
            <div class="space-y-4">
                <div><label for="school-input" class="block text-sm font-medium text-gray-700">학교</label><input type="text" id="school-input" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm" placeholder="예: 새싹중학교"></div>
                <div><label for="grade-input" class="block text-sm font-medium text-gray-700">학년</label><input type="text" id="grade-input" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm" placeholder="예: 1"></div>
                <div><label for="name-input" class="block text-sm font-medium text-gray-700">이름</label><input type="text" id="name-input" class="mt-1 block w-full px-3 py-2 border rounded-md shadow-sm" placeholder="예: 홍길동"></div>
            </div>
            <button id="start-app-button" class="w-full mt-8 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700">시험 시작하기</button>
        </div>
        <div id="unit-selection-screen" class="hidden">
            <h1 class="text-2xl sm:text-3xl font-bold text-center text-gray-800 mb-6">어휘끝 중학필수 단어 시험</h1>
            <p class="text-center text-gray-600 mb-8">시험 볼 유닛을 선택하세요. (Unit 11-20)</p>
            <div id="unit-buttons" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
        </div>
        <div id="test-screen" class="hidden">
            <div class="flex justify-between items-center mb-6"><h2 id="test-title" class="text-xl sm:text-2xl font-bold"></h2><div id="timer" class="text-lg font-semibold text-red-500 bg-red-100 px-4 py-2 rounded-lg">10:00</div></div>
            <div class="mb-6"><div class="w-full bg-gray-200 rounded-full h-2.5"><div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full"></div></div><p id="progress-text" class="text-center text-sm text-gray-600 mt-2"></p></div>
            <div id="question-container" class="text-center p-6 bg-gray-50 rounded-lg"><p id="question-type" class="text-sm font-semibold text-blue-600 mb-2"></p><p id="question" class="text-2xl sm:text-3xl font-medium mb-6 min-h-[72px] flex items-center justify-center"></p><input type="text" id="answer-input" class="w-full p-3 border rounded-lg text-lg text-center" placeholder="정답을 입력하세요"></div>
            <button id="next-button" class="w-full mt-6 bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700">다음</button>
        </div>
        <div id="results-screen" class="hidden">
            <h2 class="text-2xl sm:text-3xl font-bold text-center mb-4">시험 결과</h2>
            <div id="score-container" class="text-5xl font-bold text-center py-8 mb-6 rounded-lg"><span id="final-score"></span><span class="text-3xl text-gray-500"> / 100</span></div>
            <h3 class="text-lg font-semibold mb-4">틀린 문제 목록</h3>
            <div class="overflow-x-a
uto border rounded-lg max-h-64">
                <table class="min-w-full divide-y"><thead class="bg-gray-50 sticky top-0"><tr><th class="px-4 py-3 text-left text-xs font-medium uppercase">문제</th><th class="px-4 py-3 text-left text-xs font-medium uppercase">제출한 답</th><th class="px-4 py-3 text-left text-xs font-medium uppercase">정답</th><th class="px-4 py-3 text-left text-xs font-medium uppercase">점수</th></tr></thead><tbody id="incorrect-answers-body" class="bg-white divide-y"></tbody></table>
            </div>
            <div class="mt-8 grid grid-cols-1 sm:grid-cols-3 gap-4">
                <button id="save-results-button" class="w-full bg-green-500 text-white font-bold py-3 rounded-lg">결과 저장</button>
                <button id="retry-button" class="w-full bg-blue-500 text-white font-bold py-3 rounded-lg">다시 풀기</button>
                <button id="home-button" class="w-full bg-gray-500 text-white font-bold py-3 rounded-lg">처음으로</button>
            </div>
        </div>
    </div>
    <div id="toast" class="fixed bottom-5 right-5 bg-gray-800 text-white px-5 py-3 rounded-lg shadow-lg opacity-0 transform translate-y-5"></div>
    <script>
        const vocabularyData = {
            "Unit 11": [
                { word: "college", meaning: "대학(교)" }, { word: "university", meaning: "대학교" }, { word: "class", meaning: "학급, 반; 수업; 계급" }, { word: "classroom", meaning: "교실" }, { word: "homeroom", meaning: "반, 교실" }, { word: "grade", meaning: "학년; 성적; 등급" }, { word: "teenage", meaning: "십 대의" }, { word: "vacation", meaning: "방학; 휴가" }, { word: "graduate", meaning: "졸업하다" }, { word: "smart", meaning: "똑똑한, 영리한; 단정한, 멋진" }, { word: "ready", meaning: "준비가 된" }, { word: "textbook", meaning: "교과서" }, { word: "dictionary", meaning: "사전" }, { word: "blackboard", meaning: "칠판" }, { word: "glue", meaning: "접착제, 풀; (접착제로) 붙이다" }, { word: "uniform", meaning: "유니폼, 제복; 교복" }, { word: "schoolwork", meaning: "학업, 학교 공부" }, { word: "lesson", meaning: "수업; 과; 교훈" }, { word: "learn", meaning: "배우다, 학습하다" }, { word: "major", meaning: "전공; 주요한" }, { word: "fact", meaning: "사실" }, { word: "title", meaning: "제목, 표제" }, { word: "example", meaning: "예, 보기" }, { word: "basis", meaning: "근거, 이유" }, { word: "word", meaning: "단어, 낱말" }
            ],
            "Unit 12": [
                { word: "math", meaning: "수학" }, { word: "science", meaning: "과학" }, { word: "history", meaning: "역사" }, { word: "grammar", meaning: "문법" }, { word: "teach", meaning: "가르치다" }, { word: "explain", meaning: "설명하다" }, { word: "note", meaning: "메모, 필기; 편지, 쪽지" }, { word: "keep", meaning: "(상태를) 유지하다; ~을 계속하다; 보유하다" }, { word: "finish", meaning: "끝나다, 마치다; 마지막 부분, 끝" }, { word: "bring", meaning: "가져오다, 데려오다" }, { word: "test", meaning: "시험, 테스트; 시험하다" }, { word: "quiz", meaning: "퀴즈, (간단한) 시험" }, { word: "level", meaning: "수준, 단계; 높이" }, { word: "problem", meaning: "문제" }, { word: "puzzle", meaning: "퍼즐; 수수께끼" }, { word: "question", meaning: "질문, 의문; 질문하다" }, { word: "answer", meaning: "답, 대답; 대답하다" }, { word: "write", meaning: "쓰다, 작성하다" }, { word: "mark", meaning: "표시하다; 채점하다; 표시; 자국, 흔적" }, { word: "check", meaning: "살피다, 점검하다; 확인하다; 확인, 점검" }, { word: "fail", meaning: "실패하다; (시험에) 떨어지다" }, { word: "mistake", meaning: "실수, 잘못" }, { word: "playground", meaning: "운동장, 놀이터" }, { word: "contest", meaning: "대회, 경연" }, { word: "award", meaning: "상, 상금" }
            ],
            "Unit 13": [
                { word: "classmate", meaning: "급우, 반 친구" }, { word: "friendship", meaning: "우정" }, { word: "relationship", meaning: "관계, 사이" }, { word: "group", meaning: "무리, 집단" }, { word: "member", meaning: "구성원, 회원" }, { word: "manner", meaning: "태도; 예의; 방법, 방식" }, { word: "dear", meaning: "사랑하는, 소중한" }, { word: "favor", meaning: "호의(에서 하는 일), 친절" }, { word: "helpful", meaning: "도움이 되는" }, { word: "together", meaning: "함께, 같이" }, { word: "gather", meaning: "~을 모으다; 모이다, 집결하다" }, { word: "join", meaning: "가입하다, 참여하다; 연결하다" }, { word: "visit", meaning: "방문하다, 찾아가다; 방문" }, { word: "meet", meaning: "만나다" }, { word: "call", meaning: "~라고 부르다; 전화하다" }, { word: "message", meaning: "메시지" }, { word: "nickname", meaning: "별명, 애칭" }, { word: "trick", meaning: "속임수; 장난, 농담" }, { word: "promise", meaning: "약속하다; 약속" }, { word: "secret", meaning: "비밀; 비밀의" }, { word: "fight", meaning: "싸우다; 싸움" }, { word: "apologize", meaning: "사과하다" }, { word: "forgive", meaning: "용서하다" }, { word: "hug", meaning: "껴안다, 포옹하다" }, { word: "post", meaning: "우편, 우편물; 우편물을 발송하다" }
            ],
            "Unit 14": [
                { word: "opinion", meaning: "의견" }, { word: "idea", meaning: "생각, 아이디어" }, { word: "point", meaning: "의견, 주장; 요점; 가리키다" }, { word: "consider", meaning: "고려하다, 숙고하다; ~로 여기다" }, { word: "decide", meaning: "결정하다" }, { word: "guess", meaning: "추측하다; 추측" }, { word: "focus", meaning: "집중하다; 초점을 맞추다; 초점" }, { word: "doubt", meaning: "의심, 의문; 의심하다" }, { word: "wonder", meaning: "궁금하다; 크게 놀라다; 감탄, 경이(감)" }, { word: "imagine", meaning: "상상하다" }, { word: "prefer", meaning: "선호하다" }, { word: "concern", meaning: "걱정, 우려; 관심사; ~에 관계가 있다; ~을 걱정시키다" }, { word: "notice", meaning: "주목, 알아챔; 공고문, 안내문; 알아차리다, ~을 의식하다" }, { word: "familiar", meaning: "익숙한, 친숙한" }, { word: "understand", meaning: "이해하다, 알다" }, { word: "memory", meaning: "기억, 기억력" }, { word: "remember", meaning: "기억하다, 기억나다" }, { word: "forget", meaning: "잊다, 잊어버리다" }, { word: "mind", meaning: "마음, 정신; 지성; 언짢아하다, 상관하다" }, { word: "mental", meaning: "정신의, 마음의" }, { word: "attract", meaning: "마음을 끌다" }, { word: "believe", meaning: "믿다" }, { word: "expect", meaning: "예상하다, 기대하다" }, { word: "hope", meaning: "희망하다, 바라다; 희망" }, { word: "wish", meaning: "소망, 바람; 바라다" }
            ],
            "Unit 15": [
                { word: "sport(s)", meaning: "스포츠, 운동" }, { word: "soccer", meaning: "축구" }, { word: "football", meaning: "축구, 미식축구" }, { word: "basketball", meaning: "농구" }, { word: "race", meaning: "경주, (달리기) 시합; 인종, 종족" }, { word: "player", meaning: "선수; 재생 장치" }, { word: "athlete", meaning: "(운동)선수" }, { word: "practice", meaning: "연습; 실행, 실천; 연습하다" }, { word: "sweat", meaning: "땀; 땀을 흘리다" }, { word: "strength", meaning: "힘, 기운; 강점" }, { word: "health", meaning: "건강, 건강 상태" }, { word: "participate", meaning: "참가하다, 참여하다" }, { word: "compete", meaning: "경쟁하다" }, { word: "kick", meaning: "(발로) 차다" }, { word: "strike", meaning: "(세게) 치다; (공 등을) 치다, 차다" }, { word: "throw", meaning: "던지다" }, { word: "whistle", meaning: "호루라기; 휘파람; 휘파람을 불다" }, { word: "score", meaning: "득점; 점수; 득점하다" }, { word: "goal", meaning: "골문; 골, 득점; 목표" }, { word: "cheer", meaning: "환호(성); 환호하다, 환호성을 지르다; 응원하다" }, { word: "win", meaning: "이기다" }, { word: "beat", meaning: "(게임·시합에서) 이기다; 때리다" }, { word: "victory", meaning: "승리" }, { word: "prize", meaning: "상, 상품" }, { word: "lose", meaning: "잃어버리다; 지다, 패하다" }
            ],
            "Unit 16": [
                { word: "leisure", meaning: "여가, 한가한 시간" }, { word: "hobby", meaning: "취미" }, { word: "event", meaning: "행사; (중요한) 사건, 일" }, { word: "interest", meaning: "흥미, 관심, 호기심; (금융) 이자" }, { word: "relax", meaning: "휴식을 취하다; 긴장을 풀다" }, { word: "free", meaning: "자유로운; 무료의; ~이 없는" }, { word: "enjoy", meaning: "즐기다" }, { word: "favorite", meaning: "가장 좋아하는" }, { word: "ticket", meaning: "표, 입장권, 승차권" }, { word: "indoor", meaning: "실내의, 실내용의" }, { word: "read", meaning: "읽다" }, { word: "cartoon", meaning: "만화" }, { word: "play", meaning: "놀다, (게임·놀이 등을) 하다; (악기 등을) 연주하다; 놀이; 연극" }, { word: "game", meaning: "게임; 경기" }, { word: "film", meaning: "영화; 촬영하다, 찍다" }, { word: "cinema", meaning: "영화관, 극장" }, { word: "concert", meaning: "연주회, 콘서트" }, { word: "outdoor", meaning: "야외의" }, { word: "picnic", meaning: "소풍, 피크닉" }, { word: "camp", meaning: "야영하다; 야영지" }, { word: "tent", meaning: "텐트, 천막" }, { word: "climb", meaning: "오르다, 기어오르다" }, { word: "hike", meaning: "하이킹, 도보 여행; 하이킹을 가다" }, { word: "swim", meaning: "수영하다, 헤엄치다" }, { word: "fishing", meaning: "낚시, 어업" }
            ],
            "Unit 17": [
                { word: "meal", meaning: "식사, 끼니" }, { word: "breakfast", meaning: "아침 식사" }, { word: "dinner", meaning: "저녁 식사; 정식, 만찬" }, { word: "dessert", meaning: "후식" }, { word: "snack", meaning: "간식, 간단한 식사" }, { word: "tea", meaning: "차, 홍차" }, { word: "swallow", meaning: "삼키다, (목구멍으로) 넘기다" }, { word: "prepare", meaning: "준비하다; 대비하다, 각오하다" }, { word: "restaurant", meaning: "음식점, 레스토랑" }, { word: "waiter", meaning: "(남) 종업원" }, { word: "welcome", meaning: "환영하다; 환영; 반가운" }, { word: "order", meaning: "명령하다; 주문하다; 주문; 순서" }, { word: "recommend", meaning: "추천하다; 권하다, 권장하다" }, { word: "serve", meaning: "(음식을) 제공하다, (음식을 상에) 차려 주다" }, { word: "bill", meaning: "지폐; 계산서, 청구서; 법안" }, { word: "leftover", meaning: "남은 음식" }, { word: "flavor", meaning: "풍미, 향미, 맛" }, { word: "delicious", meaning: "아주 맛있는" }, { word: "excellent", meaning: "훌륭한, 탁월한" }, { word: "fresh", meaning: "신선한; 새로운" }, { word: "spicy", meaning: "매운, 양념 맛이 강한" }, { word: "salt", meaning: "소금" }, { word: "sweet", meaning: "달콤한; 다정한, 온화한" }, { word: "sour", meaning: "(맛이) 신, 시큼한; (우유가) 상한" }, { word: "bitter", meaning: "맛이 쓴; (언쟁이) 격렬한" }
            ],
            "Unit 18": [
                { word: "art", meaning: "미술(품); 예술" }, { word: "artwork", meaning: "(특히 박물관의) 미술품; 삽화" }, { word: "create", meaning: "창조하다, 창작하다" }, { word: "picture", meaning: "사진; 그림" }, { word: "photograph", meaning: "사진; ~의 사진을 찍다" }, { word: "portrait", meaning: "초상화" }, { word: "paint", meaning: "페인트; 페인트를 칠하다; 그리다" }, { word: "draw", meaning: "(줄, 선을 그어) 그림을 그리다; 끌다, 끌어당기다" }, { word: "statue", meaning: "동상, 조각상" }, { word: "gallery", meaning: "미술관, 화랑" }, { word: "display", meaning: "전시하다, 진열하다; 전시, 진열" }, { word: "exhibit", meaning: "전시하다; 전시, 전시품" }, { word: "reveal", meaning: "~을 드러내다, 밝히다" }, { word: "classic", meaning: "(예술품 등이) 일류의, 최고의" }, { word: "musical", meaning: "뮤지컬; 음악의, 음악적인" }, { word: "opera", meaning: "오페라, 오페라단" }, { word: "sing", meaning: "노래하다; (새가) 지저귀다, 울다" }, { word: "chorus", meaning: "합창; (노래의) 후렴" }, { word: "rhythm", meaning: "리듬; (규칙적으로 반복되는) 변화" }, { word: "harmony", meaning: "조화, 화합; (음악) 화음" }, { word: "instrument", meaning: "기계, 기구, 도구; 악기" }, { word: "guitar", meaning: "기타" }, { word: "violin", meaning: "바이올린" }, { word: "drum", meaning: "드럼, 북; (원통형) 통, 드럼통; 북[드럼]을 치다" }, { word: "trumpet", meaning: "트럼펫" }
            ],
            "Unit 19": [
                { word: "trip", meaning: "여행" }, { word: "travel", meaning: "여행하다; 이동하다; 여행, 출장, 이동" }, { word: "journey", meaning: "여행, 여정, 이동" }, { word: "adventure", meaning: "모험, 모험심" }, { word: "plan", meaning: "계획; 계획을 세우다, 계획하다" }, { word: "schedule", meaning: "일정, 스케줄; 일정을 잡다" }, { word: "flight", meaning: "(비행기) 여행, 비행; 항공편" }, { word: "airline", meaning: "항공사" }, { word: "available", meaning: "이용할 수 있는; (사람들을 만날) 시간이 있는" }, { word: "pack", meaning: "(짐을) 싸다, 꾸리다; 포장하다" }, { word: "luggage", meaning: "(여행용) 수하물, 짐" }, { word: "passport", meaning: "여권" }, { word: "delay", meaning: "미루다; 지연시키다; 지체" }, { word: "cancel", meaning: "취소하다" }, { word: "spoil", meaning: "망치다, 버려 놓다; 음식이 상하다" }, { word: "leave", meaning: "떠나다; 남기다; 휴가" }, { word: "reach", meaning: "~에 도달하다, ~에 이르다; (어떤 것을 잡기 위해 손이나 팔을) 뻗다" }, { word: "arrive", meaning: "도착하다, (물건이) 배달되다" }, { word: "tour", meaning: "여행, 관광; 순회 공연; 관광하다" }, { word: "tourist", meaning: "관광객" }, { word: "guide", meaning: "안내(서); 가이드, 안내인; 안내하여 데려가다" }, { word: "map", meaning: "지도, 약도" }, { word: "view", meaning: "경관, 전망; 견해, 생각" }, { word: "stay", meaning: "계속 있다, 머무르다; 머무름, 방문" }, { word: "return", meaning: "돌아오다; 반납하다; 돌아옴, 귀환" }
            ],
            "Unit 20": [
                { word: "weather", meaning: "날씨, 기상" }, { word: "forecast", meaning: "예보, 예측; 예보하다, 예측하다" }, { word: "climate", meaning: "기후, 기상 여건; 분위기, 풍조" }, { word: "temperature", meaning: "기온, 온도; 체온" }, { word: "degree", meaning: "(온도 단위) 도; 정도, 범위; (대학의) 학위" }, { word: "warm", meaning: "따뜻한, 따스한; 따뜻하게 하다, 데우다" }, { word: "sunshine", meaning: "햇빛, 햇살" }, { word: "shine", meaning: "빛나다, 반짝이다; 빛" }, { word: "cool", meaning: "서늘한, 시원한; 멋진, 끝내 주는; 식다, 식히다" }, { word: "freeze", meaning: "얼다, 얼리다" }, { word: "lightning", meaning: "번개, 번갯불" }, { word: "storm", meaning: "폭풍, 폭풍우" }, { word: "thunder", meaning: "천둥" }, { word: "raindrop", meaning: "빗방울" }, { word: "wet", meaning: "젖은; 비가 많이 오는, 궂은" }, { word: "fog", meaning: "안개" }, { word: "dew", meaning: "이슬" }, { word: "drought", meaning: "가뭄" }, { word: "wind", meaning: "바람" }, { word: "rainbow", meaning: "무지개" }, { word: "season", meaning: "계절; 시기, 철, 시즌; (양념을) 넣다, 치다" }, { word: "spring", meaning: "봄; 스프링, 용수철; 샘; 휙 움직이다, (갑자기) 뛰어오르다" }, { word: "summer", meaning: "여름" }, { word: "fall", meaning: "가을; 넘어짐, 떨어짐; 폭포; 떨어지다, 빠지다; 넘어지다" }, { word: "winter", meaning: "겨울" }
            ]
        };
        // --- 이하 스크립트 코드는 이전 앱들과 동일 ---
        let userInfo = {};
        let currentUnit='',questions=[],currentQuestionIndex=0,userAnswers=[],timerInterval;
        const userInfoScreen = document.getElementById('user-info-screen');
        const unitSelectionScreen=document.getElementById('unit-selection-screen');
        const testScreen=document.getElementById('test-screen');
        const resultsScreen=document.getElementById('results-screen');
        const schoolInput = document.getElementById('school-input');
        const gradeInput = document.getElementById('grade-input');
        const nameInput = document.getElementById('name-input');
        const startAppButton = document.getElementById('start-app-button');
        const unitButtonsContainer=document.getElementById('unit-buttons');
        const testTitle=document.getElementById('test-title');
        const timerDisplay=document.getElementById('timer');
        const progressBar=document.getElementById('progress-bar');
        const progressText=document.getElementById('progress-text');
        const questionType=document.getElementById('question-type');
        const questionEl=document.getElementById('question');
        const answerInput=document.getElementById('answer-input');
        const nextButton=document.getElementById('next-button');
        const finalScore=document.getElementById('final-score');
        const incorrectAnswersBody=document.getElementById('incorrect-answers-body');
        const saveResultsButton=document.getElementById('save-results-button');
        const retryButton=document.getElementById('retry-button');
        const homeButton=document.getElementById('home-button');
        
        function init(){
            Object.keys(vocabularyData).sort((a,b)=>parseInt(a.match(/\d+/)[0])-parseInt(b.match(/\d+/)[0])).forEach(unit=>{const button=document.createElement('button');button.textContent=unit;button.className='bg-white text-gray-700 font-semibold py-4 px-2 rounded-lg shadow hover:bg-gray-200 border border-gray-200 transition-all duration-200';button.onclick=()=>startTest(unit);unitButtonsContainer.appendChild(button)});
            startAppButton.addEventListener('click', startApp);
            nextButton.addEventListener('click',handleNext);
            answerInput.addEventListener('keyup',e=>{if(e.key==='Enter'){handleNext()}});
            retryButton.addEventListener('click',()=>startTest(currentUnit));
            homeButton.addEventListener('click',()=>showScreen(unitSelectionScreen));
            saveResultsButton.addEventListener('click',saveResults);
            showScreen(userInfoScreen);
        }

        function startApp() {
            const school = schoolInput.value.trim();
            const grade = gradeInput.value.trim();
            const name = nameInput.value.trim();
            if (!school || !grade || !name) {
                showToast("모든 정보를 입력해주세요.");
                return;
            }
            userInfo = { school, grade, name };
            showScreen(unitSelectionScreen);
        }

        function showScreen(screen){
            [userInfoScreen, unitSelectionScreen,testScreen,resultsScreen].forEach(s=>s.classList.add('hidden'));
            screen.classList.remove('hidden');
        }

        async function saveResults(){
            const score=finalScore.textContent;
            let title = `${userInfo.school} ${userInfo.grade}학년 ${userInfo.name}의 ${currentUnit} 시험지`;
            let resultsText = `${title}\n\n총점: ${score}점\n\n--- 틀린 문제 목록 ---\n`;
            const incorrectRows=incorrectAnswersBody.querySelectorAll('tr');
            if(incorrectRows.length===1&&incorrectRows[0].children[0].colSpan===4){
                resultsText+="틀린 문제가 없습니다."
            } else {
                incorrectRows.forEach(row=>{
                    const cells=row.querySelectorAll('td');
                    resultsText+=`문제: ${cells[0].textContent}\n`;
                    resultsText+=`제출 답: ${cells[1].textContent}\n`;
                    resultsText+=`정답: ${cells[2].textContent}\n`;
                    resultsText+=`점수: ${cells[3].textContent}\n\n`;
                });
            }
            try{
                await navigator.clipboard.writeText(resultsText.trim());
                showToast('시험 결과가 클립보드에 복사되었습니다.');
            } catch(err) {
                console.error('클립보드 복사 실패:',err);
                showToast('결과 복사에 실패했습니다.');
            }
        }
        
        function startTest(unit){currentUnit=unit;let unitWords=[...vocabularyData[unit]];questions=[];userAnswers=[];currentQuestionIndex=0;unitWords.sort(()=>0.5-Math.random());const numQuestions=Math.min(20,unitWords.length);const selectedWords=unitWords.slice(0,numQuestions);const half=Math.ceil(numQuestions/2);for(let i=0;i<numQuestions;i++){const wordData=selectedWords[i];const type=i<half?'spelling':'meaning';questions.push({type:type,word:wordData.word,meaning:wordData.meaning,originalQuestion:type==='spelling'?wordData.meaning:wordData.word})}
        questions.sort(()=>0.5-Math.random());testTitle.textContent=`${unit} 단어 시험`;showScreen(testScreen);displayQuestion();startTimer()}
        function displayQuestion(){if(currentQuestionIndex>=questions.length){submitTest();return}
        const q=questions[currentQuestionIndex];if(q.type==='spelling'){questionType.textContent='의미를 보고 철자 맞히기';questionEl.textContent=q.meaning.replace(/(\d+\.\s*)|[()]/g,'').replace(/;/g,', ')}else{questionType.textContent='철자를 보고 의미 맞히기';questionEl.textContent=q.word}
        answerInput.value='';answerInput.focus();updateProgress();if(currentQuestionIndex===questions.length-1){nextButton.textContent='채점하기'}else{nextButton.textContent='다음'}}
        function handleNext(){const answer=answerInput.value.trim();if(!answer){answerInput.classList.add('incorrect-flash');setTimeout(()=>answerInput.classList.remove('incorrect-flash'),500);return}
        userAnswers[currentQuestionIndex]=answer;const isCorrectAnswer=isAnswerInitiallyCorrect(questions[currentQuestionIndex],answer);answerInput.classList.add(isCorrectAnswer?'correct-flash':'incorrect-flash');setTimeout(()=>answerInput.classList.remove('correct-flash','incorrect-flash'),500);setTimeout(()=>{currentQuestionIndex++;displayQuestion()},300)}
        function isAnswerInitiallyCorrect(question,answer){if(question.type==='spelling'){return question.word.toLowerCase()===answer.toLowerCase()}else{const cleanCorrectAnswer=question.meaning.toLowerCase().replace(/(\d+\.\s*)|[()]/g,'');const userFirstMeaning=answer.split(/[,;]/)[0].toLowerCase().trim();return cleanCorrectAnswer.includes(userFirstMeaning)}}
        function updateProgress(){const progress=((currentQuestionIndex)/questions.length)*100;progressBar.style.width=`${progress}%`;progressText.textContent=`문제 ${currentQuestionIndex+1} / ${questions.length}`}
        function startTimer(){let timeLeft=600;timerDisplay.textContent="10:00";clearInterval(timerInterval);timerInterval=setInterval(()=>{timeLeft--;const minutes=Math.floor(timeLeft/60);const seconds=timeLeft%60;timerDisplay.textContent=`${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`;if(timeLeft<=0){clearInterval(timerInterval);submitTest()}},1000)}
        function submitTest(){clearInterval(timerInterval);let totalScore=0;const incorrectAnswers=[];questions.forEach((q,index)=>{const userAnswer=userAnswers[index]||"";let score=0;if(q.type==='spelling'){score=userAnswer.toLowerCase()===q.word.toLowerCase()?100:0}else{score=calculateMeaningScore(userAnswer,q.meaning)}
        if(score<100){incorrectAnswers.push({question:q.originalQuestion,userAnswer:userAnswer||"미응답",correctAnswer:q.type==='spelling'?q.word:q.meaning,score:score})}
        totalScore+=score});const averageScore=questions.length>0?Math.round(totalScore/questions.length):0;displayResults(averageScore,incorrectAnswers)}
        function calculateMeaningScore(userAnswer,correctAnswer){const normalize=str=>str.toLowerCase().replace(/[()]/g,'').trim();const cleanCorrectAnswer=correctAnswer.replace(/\d+\.\s*/g,'').trim();const cleanUserAnswer=userAnswer.trim();if(cleanUserAnswer==="")return 0;const meaningGroups=cleanCorrectAnswer.split(';').map(g=>g.trim().split(',').map(s=>normalize(s)).filter(s=>s));const userMeanings=cleanUserAnswer.split(/[,;]/).map(m=>normalize(m)).filter(m=>m);const allPossibleCorrectMeanings=new Set(meaningGroups.flat());for(const userMeaning of userMeanings){let isMeaningValid=false;for(const correctMeaning of allPossibleCorrectMeanings){if(correctMeaning.includes(userMeaning)||userMeaning.includes(correctMeaning)){isMeaningValid=true;break}}
        if(!isMeaningValid){return 0}}
        let matchedGroupsCount=0;for(const group of meaningGroups){let isGroupMatched=false;for(const userMeaning of userMeanings){for(const similarMeaning of group){if(similarMeaning.includes(userMeaning)||userMeaning.includes(similarMeaning)){isGroupMatched=true;break}}
        if(isGroupMatched)break}
        if(isGroupMatched){matchedGroupsCount++}}
        if(meaningGroups.length===0)return 100;const matchedRatio=matchedGroupsCount/meaningGroups.length;if(matchedRatio>=1){return 100}else if(matchedRatio>=0.5){return 50}else{return 0}}
        function displayResults(score,incorrectList){finalScore.textContent=score;const scoreContainer=finalScore.parentElement;scoreContainer.className='text-5xl font-bold text-center py-8 mb-6 rounded-lg';if(score>=80){scoreContainer.classList.add('text-blue-600')}else if(score>=50){scoreContainer.classList.add('text-yellow-600')}else{scoreContainer.classList.add('text-red-600')}
        incorrectAnswersBody.innerHTML='';if(incorrectList.length===0){incorrectAnswersBody.innerHTML=`<tr><td colspan="4" class="text-center py-4 text-gray-500">틀린 문제가 없습니다! 완벽해요!</td></tr>`}else{incorrectList.forEach(item=>{const row=`<tr class="text-sm"><td class="px-4 py-3 align-top">${item.question}</td><td class="px-4 py-3 align-top text-red-600">${item.userAnswer}</td><td class="px-4 py-3 align-top text-blue-600">${item.correctAnswer}</td><td class="px-4 py-3 align-top font-semibold">${item.score}점</td></tr>`;incorrectAnswersBody.innerHTML+=row})}
        showScreen(resultsScreen)}
        function showToast(message){const toast=document.getElementById('toast');toast.textContent=message;toast.classList.remove('opacity-0','translate-y-5');setTimeout(()=>{toast.classList.add('opacity-0','translate-y-5')},2500)}
        init();
    </script>
</body>
</html>

